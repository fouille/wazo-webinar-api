import"@fortawesome/fontawesome-free/js/fontawesome";import"@fortawesome/fontawesome-free/js/solid";import"@fortawesome/fontawesome-free/js/regular";import"@fortawesome/fontawesome-free/js/brands";import Swal from"sweetalert2";export const version='<a href="LICENSE.md" target="_blank">Licence : MIT</a> - Wazo SAS © - [AIV]{date} - {version}[/AIV]';export const access_domain="https://repertoire.lechesnay-rocquencourt.fr";export const token=sessionStorage.getItem("token");export const tenant_uuid=sessionStorage.getItem("tenant_uuid");export const api_confd_users="/api/confd/1.1/users/";export const options={method:"GET",headers:{accept:"application/json","Wazo-Tenant":tenant_uuid,"X-Auth-Token":token}};export function session_error(){Swal.fire({title:"Ooops!",text:"La session semble avoir expirée",icon:"error",allowEscapeKey:!1,allowOutsideClick:!1}).then((e=>{e.isConfirmed&&(document.location.href="../")}))}export function doGetUserData(e,t){fetch(e,t).then((function(e){if(!e.ok)throw 401==e.status&&session_error(),new Error(e.status);return e.json()})).then((function(e){let t="";null!==e.lastname&&(t=e.lastname),$("#pbx_user_uuid").html(e.firstname+" "+t)})).catch((function(e){console.log(e)}))}$("#submit").on("click",(function(e){let t=$(this);e.preventDefault(),t.html('<i class="fa fa-spinner fa-spin" aria-hidden="true"></i> Connexion');let o=$("#login").val()+":"+$("#password").val(),n=btoa(o),a={method:"POST",body:JSON.stringify({client_id:"user_chesnay_token",access_type:"offline",backend:"ldap_user",expiration:"43200",domain_name:"lechesnay.local"}),headers:{"Content-type":"application/json",accept:"application/json",Authorization:"Basic "+n}};fetch(access_domain+"/api/auth/0.1/token",a).then((function(e){if(!e.ok)throw 401==e.status&&(t.html("se connecter"),Swal.fire("Ooops!","Il y a certainement une erreur dans votre identifiant ou mot de passe","error")),new Error("HTTP error, status = "+e.status);return e.json()})).then((function(e){sessionStorage.setItem("token",e.data.token),sessionStorage.setItem("pbx_user_uuid",e.data.metadata.pbx_user_uuid),sessionStorage.setItem("tenant_uuid",e.data.metadata.tenant_uuid),document.location.href="app/"})).catch((function(e){console.log(e)}))})),$(".logout").on("click",(function(e){e.preventDefault,fetch(access_domain+"/api/auth/0.1/token/"+token,{method:"DELETE",headers:{accept:"application/json","X-Auth-Token":token}}).then((function(e){if(!e.ok)throw new Error("HTTP error, status = "+e.status)})).then((function(e){sessionStorage.clear(),document.location.href="../"})).catch((function(e){console.log(e)}))})),$(".version").html(version);